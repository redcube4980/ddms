/*! $Id: page_image.js 182 2013-01-17 06:31:45Z tomita $ */
var UseNormalImage=true;function PageImage(b,e,a,c){this.pageImageWidth=b;this.pageImageHeight=e;this.pageLargeImageWidth=a;this.pageLargeImageHeight=c;this.pageWidth=b;this.pageHeight=e;this.scale=1;this.ratio=1;this.lightWeight=false;this.currentPage;this.visibleLink;this.loadSliceImages=false;this.loadCompleteSliceImages=false;this.containerNode=document.createElement("div");this.containerNode.className="Page";this.containerNode.style.position="absolute";this.containerNode.style.top="0px";this.containerNode.style.left="0px";this.containerNode.style.width=this.pageWidth+"px";this.containerNode.style.height=this.pageHeight+20+"px";this.containerNode.style.webkitTransformOrigin="0px 0px 0";this.containerNode.style.webkitTransform="translate3d(0px, 0px, 0px) scale(1.0)";var d=this;this.containerNode.addEventListener("mouseup",function(f){d.onClickHandler(f)},false);this.divPageImage=document.createElement("div");this.divPageImage.style.position="absolute";this.divPageImage.style.overflow="hidden";this.divPageImage.style.top="0px";this.divPageImage.style.left="0px";this.divPageImage.style.webkitTransformOrigin="0px 0px 0";this.containerNode.appendChild(this.divPageImage);this._createDivPageImage();this.divSliceImages=document.createElement("div");this.divSliceImages.style.position="absolute";this.divSliceImages.style.overflow="hidden";this.divSliceImages.style.top="0px";this.divSliceImages.style.left="0px";this.divSliceImages.style.webkitTransformOrigin="0px 0px 0";this.containerNode.appendChild(this.divSliceImages);this._createDivSliceImages();this.divLinkLayer=document.createElement("div");this.containerNode.appendChild(this.divLinkLayer);this.divLinkLayer.style.position="absolute";this.divLinkLayer.style.top="0px";this.divLinkLayer.style.left="0px";this._showLayer(this.divPageImage);this._hideLayer(this.divSliceImages)}PageImage.prototype._createDivPageImage=function(){this.pageImage=new Image;this.pageImage.style.backgroundColor="#aaaaaa";this.divPageImage.appendChild(this.pageImage)};PageImage.prototype._createDivSliceImages=function(){var c=this;this.sliceImages=[];for(var b=0;b<16;b++){var a=new Image;a.onload=function(){for(var d=0;d<c.sliceImages.length;d++){if(!c.sliceImages[d].complete){return}}if(!c.loadCompleteSliceImages){c.loadCompleteSliceImages=true;c.onLoadSliceImages()}};this.sliceImages.push(a)}while(this.divSliceImages.childNodes.length){this.divSliceImages.removeChild(this.divSliceImages.childNodes[0])}for(var b=0;b<16;b++){this.divSliceImages.appendChild(this.sliceImages[b])}};PageImage.prototype.getDOMNode=function(){return this.containerNode};PageImage.prototype.setX=function(a){this.setPos(a,this.getY())};PageImage.prototype.setY=function(a){this.setPos(this.getX(),a)};PageImage.prototype.setPos=function(a,c){var b=this.containerNode.style.webkitTransform;b=b.replace(/translate3d\(.*?\)/,"translate3d("+parseInt(a)+"px, "+parseInt(c)+"px, 0px)");this.containerNode.style.webkitTransform=b};PageImage.prototype.setPosAndScale=function(a,c,b){this.scale=parseFloat(b).toFixed(3);this.containerNode.style.webkitTransform="translate3d("+parseInt(a)+"px, "+parseInt(c)+"px, 0px) scale("+this.scale+")"};PageImage.prototype.getX=function(){if(!this.containerNode.style.webkitTransform){return 0}if(this.containerNode.style.webkitTransform.match(/translate3d\(([0-9.-]+)px,\s*([0-9.-]+)px.*?\)/)){return parseInt(RegExp.$1)}return 0};PageImage.prototype.getY=function(){if(!this.containerNode.style.webkitTransform){return 0}if(this.containerNode.style.webkitTransform.match(/translate3d\(([0-9.-]+)px,\s*([0-9.-]+)px.*?\)/)){return parseInt(RegExp.$2)}return 0};PageImage.prototype.getImageWidth=function(){return this.pageImageWidth};PageImage.prototype.getImageHeight=function(){return this.pageImageHeight};PageImage.prototype.getWidth=function(){return this.pageWidth};PageImage.prototype.getHeight=function(){return this.pageHeight};PageImage.prototype.setWidth=function(a){if(this.pageWidth==a){return}this.ratio=a/this.pageImageWidth;this.pageWidth=a;this.pageHeight=this.ratio*this.pageImageHeight;this.containerNode.style.width=this.pageWidth+"px";this.containerNode.style.height=this.pageHeight+"px";if(this.visibleLink){this.createPageLink()}this.divPageImage.style.webkitTransform="translate3d(0px, 0px, 0px) scale("+this.ratio+")";var b=pageWidth_2X/this.pageImageWidth;this.divSliceImages.style.webkitTransform="translate3d(0px, 0px, 0px) scale("+(this.ratio/b)+")";this._updateImageLayer()};PageImage.prototype.viewPage=function(a){this.clearPage();this.currentPage=parseInt(a,10);if(UseNormalImage){this._loadImage(a)}if(this.visibleLink){this.createPageLink()}this._updateImageLayer()};PageImage.prototype.clearPage=function(){this.currentPage=null;this.loadSliceImages=false;this.pageImage.src="../skinimage/s.gif";for(var a=0;a<16;a++){this.sliceImages[a].src="../skinimage/s.gif"}};PageImage.prototype.getCurrentPage=function(){return this.currentPage};PageImage.prototype.setLightWeightMode=function(b){var a=b?true:false;this.lightWeight=a;this._updateImageLayer()};PageImage.prototype.show=function(){this.containerNode.style.display="block"};PageImage.prototype.hide=function(){this.containerNode.style.display="none"};PageImage.prototype._showLayer=function(a){a.style.visibility="visible"};PageImage.prototype._hideLayer=function(a){a.style.visibility="hidden"};PageImage.prototype._loadImage=function(a){this.pageImage.src="../images/"+a+".jpg"};PageImage.prototype._loadSliceImages=function(b){this.loadCompleteSliceImages=false;for(var a=0;a<16;a++){this.sliceImages[a].src="../images/"+b+"-"+(a+1)+".jpg"}};PageImage.prototype.imageLoadCompleted=function(){return this.pageImage.complete};PageImage.prototype.getRatio=function(){return this.ratio};PageImage.prototype.setScale=function(b){this.scale=b;var a=this.containerNode.style.webkitTransform;a=a.replace(/scale\(.*?\)/,"scale("+this.scale+")");this.containerNode.style.webkitTransform=a;this._updateImageLayer()};PageImage.prototype.getScale=function(){return this.scale};PageImage.prototype.createPageLink=function(){var d=this.currentPage;var c="";var b=this.getWidth()/this.pageLargeImageWidth;if(typeof linkDataCache[d]!="undefined"){var c="";for(var a=0;a<linkDataCache[d].length;a++){c+=this.createLink(linkDataCache[d][a],0,0,b)}}this.divLinkLayer.innerHTML=c};PageImage.prototype.createLink=function(k,m,l,g){var n=k[6].split(".");var e=n[n.length-1];var f=linkRatio;var o,r;var d=LinkOpacityDefaultMobileSafari;var j=d;o="opacity:"+d+";";r='    OnLoad="this.style.opacity='+d+'"     OnMouseOver="this.style.opacity='+j+'"     OnMouseOut="this.style.opacity='+d+'"     OnMouseUp="event.stopPropagation()" ';var a="";var q=0;var c=0;switch(LinkDrawTypeMobileSafari){case"Paint":default:a="background-color: "+LinkColorType2Value(k[7])+";";break;case"Border":a="border: "+LinkBorderWidthMobileSafari+"px solid "+LinkColorType2Value(k[7])+";";q=LinkBorderWidthMobileSafari*2;c=LinkBorderWidthMobileSafari*2;break}var b=typeof k[8]=="undefined"?"":k[8];var p=k[4]*g*f-q;if(p<=0){p=1}var i=k[5]*g*f-c;if(i<=0){i=1}var h='<div style="position:absolute; left:'+(m+k[2]*g*f)+"px; top:"+(l+k[3]*g*f)+"px; width:"+p+"px; height:"+i+"px; cursor: pointer; "+o+" "+a+'z-index:70; visibility:visible;" '+r+"OnClick=\"GotoLink('"+k[1]+"' , '"+k[6]+"', "+k[0]+", '"+b+"')\"></div>";return h};PageImage.prototype.showLink=function(){this.divLinkLayer.style.display="block";this.visibleLink=true;this.createPageLink()};PageImage.prototype.hideLink=function(){this.divLinkLayer.style.display="none";this.visibleLink=false};PageImage.prototype.onLoadSliceImages=function(){this._updateImageLayer()};PageImage.prototype._updateImageLayer=function(){var a=this.pageWidth;var b=this.pageHeight;if(!UseNormalImage){if(!this.loadSliceImages){this._loadSliceImages(this.currentPage);this.loadSliceImages=true}this._showLayer(this.divSliceImages);this._hideLayer(this.divPageImage);return}if(this.lightWeight||this.pageImageWidth>a*this.getScale()){this._showLayer(this.divPageImage);this._hideLayer(this.divSliceImages)}else{if(this.currentPage!==null&&!this.loadSliceImages){this._loadSliceImages(this.currentPage);this.loadSliceImages=true}if(this.loadCompleteSliceImages){this._showLayer(this.divSliceImages);this._showLayer(this.divPageImage)}}};PageImage.prototype.onClickHandler=function(a){if(this.onClick){this.onClick(a)}};function PageImageDouble(b,d,a,c){this.parent=PageImage;this.parent(b,d,a,c);this.pageWidth=b*2;this.containerNode.style.width=this.pageWidth+"px"}PageImageDouble.prototype=new PageImage();PageImageDouble.prototype._createDivPageImage=function(){this.pageImage=new Image;this.pageImage.style.backgroundColor="#aaaaaa";this.pageImage.style.position="absolute";this.pageImage.style.left="0px";this.pageImage.style.top="0px";this.pageImage2=new Image;this.pageImage2.style.backgroundColor="#aaaaaa";this.pageImage2.style.position="absolute";this.pageImage2.style.left=this.pageImageWidth+"px";this.pageImage2.style.top="0px";this.divPageImage.appendChild(this.pageImage);this.divPageImage.appendChild(this.pageImage2);this.divPageImage.style.width=this.pageImageWidth*2+"px";this.divPageImage.style.height=this.pageImageHeight+"px"};PageImageDouble.prototype._createDivSliceImages=function(){var d=this;this.divSliceImagesLeft=document.createElement("div");this.divSliceImagesLeft.style.position="absolute";this.divSliceImagesLeft.style.overflow="hidden";this.divSliceImagesLeft.style.top="0px";this.divSliceImagesLeft.style.left="0px";this.divSliceImagesLeft.style.width=this.pageLargeImageWidth+"px";this.divSliceImagesRight=document.createElement("div");this.divSliceImagesRight.style.position="absolute";this.divSliceImagesRight.style.overflow="hidden";this.divSliceImagesRight.style.top="0px";this.divSliceImagesRight.style.left=this.pageLargeImageWidth+"px";this.divSliceImagesRight.style.width=this.pageLargeImageWidth+"px";this.divSliceImages.appendChild(this.divSliceImagesLeft);this.divSliceImages.appendChild(this.divSliceImagesRight);this.divSliceImages.style.width=this.pageLargeImageWidth*2+"px";this.divSliceImages.style.height=this.pageLargeImageHeight+"px";this.sliceImages=[];this.sliceImages2=[];for(var b=0;b<16;b++){var a=new Image;var c=new Image;a.onload=function(){for(var e=0;e<d.sliceImages.length;e++){if(!d.sliceImages[e].complete){return}}if(!d.loadCompleteSliceImages){d.loadCompleteSliceImages=true;d.onLoadSliceImages()}};c.onload=function(){for(var e=0;e<d.sliceImages2.length;e++){if(!d.sliceImages2[e].complete){return}}if(!d.loadCompleteSliceImages){d.loadCompleteSliceImages=true;d.onLoadSliceImages()}};this.sliceImages.push(a);this.sliceImages2.push(c)}while(this.divSliceImagesLeft.childNodes.length){this.divSliceImagesLeft.removeChild(this.divSliceImagesLeft.childNodes[0])}while(this.divSliceImagesRight.childNodes.length){this.divSliceImagesRight.removeChild(this.divSliceImagesRight.childNodes[0])}for(var b=0;b<16;b++){this.divSliceImagesLeft.appendChild(this.sliceImages[b]);this.divSliceImagesRight.appendChild(this.sliceImages2[b])}};PageImageDouble.prototype._loadImage=function(a){if(IsLeftTemplate){this.pageImage.src="../images/"+a+".jpg";this.pageImage2.src="../images/"+(a+1)+".jpg"}else{this.pageImage.src="../images/"+(a+1)+".jpg";this.pageImage2.src="../images/"+a+".jpg"}};PageImageDouble.prototype._loadSliceImages=function(b){this.loadCompleteSliceImages=false;for(var a=0;a<16;a++){if(IsLeftTemplate){this.sliceImages[a].src="../images/"+b+"-"+(a+1)+".jpg";this.sliceImages2[a].src="../images/"+(b+1)+"-"+(a+1)+".jpg"}else{this.sliceImages[a].src="../images/"+(b+1)+"-"+(a+1)+".jpg";this.sliceImages2[a].src="../images/"+b+"-"+(a+1)+".jpg"}}};PageImageDouble.prototype.setWidth=function(a){if(this.pageWidth==a){return}this.ratio=a/2/this.pageImageWidth;this.pageWidth=a;this.pageHeight=this.ratio*this.pageImageHeight;this.containerNode.style.width=this.pageWidth+"px";this.containerNode.style.height=this.pageHeight+"px";if(this.visibleLink){this.createPageLink()}this.divPageImage.style.webkitTransform="translate3d(0px, 0px, 0px) scale("+this.ratio+")";var b=pageWidth_2X/this.pageImageWidth;this.divSliceImages.style.webkitTransform="translate3d(0px, 0px, 0px) scale("+(this.ratio/b)+")";this._updateImageLayer()};PageImageDouble.prototype.clearPage=function(){this.currentPage=null;this.loadSliceImages=false;this.pageImage.src="../skinimage/s.gif";for(var a=0;a<16;a++){this.sliceImages[a].src="../skinimage/s.gif";this.sliceImages2[a].src="../skinimage/s.gif"}};PageImageDouble.prototype.createPageLink=function(){var f="";var d=this.getWidth()/2/this.pageLargeImageWidth;var e=this.currentPage;var c,b;if(IsLeftTemplate){c=0;b=this.getWidth()/2}else{c=this.getWidth()/2;b=0}if(typeof linkDataCache[e]!="undefined"){for(var a=0;a<linkDataCache[e].length;a++){f+=this.createLink(linkDataCache[e][a],c,0,d)}}e++;if(typeof linkDataCache[e]!="undefined"){for(var a=0;a<linkDataCache[e].length;a++){f+=this.createLink(linkDataCache[e][a],b,0,d)}}this.divLinkLayer.innerHTML=f};PageImageDouble.prototype._updateImageLayer=function(){var a=this.pageWidth;var b=this.pageHeight;if(!UseNormalImage){if(!this.loadSliceImages){this._loadSliceImages(this.currentPage);this.loadSliceImages=true}this._showLayer(this.divSliceImages);this._hideLayer(this.divPageImage);return}if(this.lightWeight||this.pageImageWidth*2>a*this.getScale()){this._showLayer(this.divPageImage);this._hideLayer(this.divSliceImages)}else{if(this.currentPage!==null&&!this.loadSliceImages){this._loadSliceImages(this.currentPage);this.loadSliceImages=true}if(this.loadCompleteSliceImages){this._showLayer(this.divSliceImages);this._showLayer(this.divPageImage)}}};function ThumbImage(a,c){this.pageImageWidth=a;this.pageImageHeight=c;this.containerWidth=a;this.containerHeight=c;this.pageNumberHeight=ThumbPageNumberHeight;this.containerHeight+=this.pageNumberHeight;this.pageImageDispWidth;this.pageImageDispHeight;this.currentPage;this.pageNumber=0;this.pageImage=new Image;this.pageImage.style.backgroundColor="#aaaaaa";this.containerNode=document.createElement("div");this.containerNode.className="ThumbPage";this.containerNode.style.position="absolute";this.containerNode.style.top="0px";this.containerNode.style.left="0px";this.containerNode.style.width=this.containerWidth+"px";this.containerNode.style.height=this.containerHeight+"px";var b=this;this.containerNode.addEventListener("mouseup",function(d){b.onClickHandler(d)},false);this.divPageImage=document.createElement("div");this.divPageImage.style.position="absolute";this.divPageImage.style.overflow="hidden";this.divPageImage.style.top="0px";this.divPageImage.style.left="5px";this.divPageImage.appendChild(this.pageImage);this.containerNode.appendChild(this.divPageImage);this.pageNumberNode=document.createElement("span");this.pageNumberNode.className="ThumbPageNumber";this.pageNumberNode.style.position="absolute";this.containerNode.appendChild(this.pageNumberNode);this._calcImageDispSize();this._updateImageLayer()}ThumbImage.prototype.getDOMNode=function(){return this.containerNode};ThumbImage.prototype.setX=function(a){this.containerNode.style.left=parseInt(a)+"px"};ThumbImage.prototype.setY=function(a){this.containerNode.style.top=parseInt(a)+"px"};ThumbImage.prototype.setPos=function(a,b){this.setX(a);this.setY(b)};ThumbImage.prototype.getX=function(){return parseInt(this.containerNode.style.left)};ThumbImage.prototype.getY=function(){return parseInt(this.containerNode.style.top)};ThumbImage.prototype.getImageWidth=function(){return this.pageImageWidth};ThumbImage.prototype.getImageHeight=function(){return this.pageImageHeight};ThumbImage.prototype.getWidth=function(){return this.containerWidth};ThumbImage.prototype.getHeight=function(){return this.containerHeight};ThumbImage.prototype.setWidth=function(a){this.containerWidth=a;this.containerNode.style.width=this.containerWidth+"px";this._calcImageDispSize();this._updateImageLayer()};ThumbImage.prototype.setHeight=function(a){this.containerHeight=a;this.containerNode.style.height=this.containerHeight+"px";this._calcImageDispSize();this._updateImageLayer()};ThumbImage.prototype.viewPage=function(a){this.currentPage=a;this.clearPage();this._loadImage(a);this._updateImageLayer()};ThumbImage.prototype.clearPage=function(){this.pageImage.src="../skinimage/s.gif"};ThumbImage.prototype.getPageNumber=function(){return this.pageNumber};ThumbImage.prototype.setPageNumber=function(a){this.pageNumber=a;this._updateImageLayer()};ThumbImage.prototype.show=function(){this.containerNode.style.display="block"};ThumbImage.prototype.hide=function(){this.containerNode.style.display="none"};ThumbImage.prototype._loadImage=function(a){this.pageImage.src="../thumbnails/"+a+".jpg"};ThumbImage.prototype._calcImageDispSize=function(){var f=this.containerWidth;var b=this.containerHeight-this.pageNumberHeight;var d=f/b;var e=pageWidth_1X/pageHeight_1Y;var c=b;var a=c*e;if(a>f){a=f;c=a/e}a=parseInt(a);if(a==this.containerWidth-1){a++}this.pageImageDispWidth=a;this.pageImageDispHeight=parseInt(c)};ThumbImage.prototype._updateImageLayer=function(){this.pageImage.style.width=this.pageImageDispWidth+"px";this.pageImage.style.height=this.pageImageDispHeight+"px";this.divPageImage.style.top="0px";this.divPageImage.style.left=parseInt((this.containerWidth-this.pageImageDispWidth)/2)+"px";var a=this.pageNumber;if(a<0){a=0}this.pageNumberNode.innerHTML=a;this.pageNumberNode.style.left=parseInt(this.containerNode.offsetWidth)-parseInt(this.pageNumberNode.offsetWidth)+"px";this.pageNumberNode.style.top=parseInt(this.containerNode.offsetHeight)-parseInt(this.pageNumberNode.offsetHeight)+"px"};ThumbImage.prototype.onClickHandler=function(a){if(this.onClick){this.onClick(a)}};