/*! $Id: gesture.js 188 2013-06-04 09:21:50Z tomita $ */
function GestureManager(){var b=this;this.touchWork={startX:null,startY:null,oldX:null,oldY:null,centerX:null,centerY:null,pinchDistance:null,save_time:null,oldX2:null,oldY2:null,vX:0,vY:0,};this.lastSingleTouch=null;document.addEventListener("touchstart",function(c){b.touchStart(c)},false);document.addEventListener("touchmove",function(c){b.touchMove(c)},false);document.addEventListener("touchend",function(c){b.touchEnd(c)},false);this.gestureWork={};document.addEventListener("gesturestart",function(c){b.gestureStart(c)},false);document.addEventListener("gesturechange",function(c){b.gestureChange(c)},false);document.addEventListener("gestureend",function(c){b.gestureEnd(c)},false);this.emulateGestureEvent=false;var a=new EBUtil.Platform;if(a.isAndroid()&&parseFloat(a.osVersionString())>=4){this.emulateGestureEvent=true}}GestureManager.prototype.gestureStart=function(a){if(this.onGestureStart){this.onGestureStart(a)}};GestureManager.prototype.gestureChange=function(b){var a={centerX:this.touchWork.centerX,centerY:this.touchWork.centerY,pinchDistance:this.touchWork.pinchDistance,};if(this.touchWork.centerX!==null&&this.onGestureChange){this.onGestureChange(b,a)}b.preventDefault()};GestureManager.prototype.gestureEnd=function(a){if(this.onGestureEnd){this.onGestureEnd(a)}};GestureManager.prototype.touchStart=function(c){var a=new Date;this.touchWork.save_time=a.getTime();this.touchWork.startX=c.touches[0].clientX;this.touchWork.startY=c.touches[0].clientY;this.touchWork.oldX=c.touches[0].clientX;this.touchWork.oldY=c.touches[0].clientY;this.touchWork.oldX2=c.touches[0].clientX;this.touchWork.oldY2=c.touches[0].clientY;if(this.onTouchStart){this.onTouchStart(c)}if(c.touches.length==1){var b=this.lastSingleTouch;var a=new Date;this.lastSingleTouch=a.getTime();if(b!==null){if(this.lastSingleTouch-b<500){if(this.onDoubleClick){this.onDoubleClick(c)}c.preventDefault()}}}if(this.emulateGestureEvent&&c.touches.length==2){this.gestureStart(c)}};GestureManager.prototype.touchMove=function(g){if(this.onTouchMove){this.onTouchMove(g)}if(g.touches.length>=2){this.touchWork.centerX=parseInt((g.touches[0].clientX+g.touches[1].clientX)/2);this.touchWork.centerY=parseInt((g.touches[0].clientY+g.touches[1].clientY)/2);this.touchWork.pinchDistance=parseInt(Math.sqrt(Math.pow(g.touches[0].clientX-g.touches[1].clientX,2)+Math.pow(g.touches[0].clientY-g.touches[1].clientY,2)));if(this.emulateGestureEvent){this.gestureChange(g)}}if(g.touches.length!=1){return}var d=g.touches[0].clientX-this.touchWork.oldX;var a=g.touches[0].clientY-this.touchWork.oldY;this.touchWork.oldX=g.touches[0].clientX;this.touchWork.oldY=g.touches[0].clientY;var c=new Date;var b=c.getTime();if(b>this.touchWork.save_time+100){var f=(b-this.touchWork.save_time)/1000;this.touchWork.save_time=b;this.touchWork.vX=(g.touches[0].clientX-this.touchWork.oldX2)/f;this.touchWork.vY=(g.touches[0].clientY-this.touchWork.oldY2)/f;this.touchWork.oldX2=g.touches[0].clientX;this.touchWork.oldY2=g.touches[0].clientY}if(this.onDrag){var e={startX:this.touchWork.startX,startY:this.touchWork.startY,diffX:d,diffY:a,vX:this.touchWork.vX,vY:this.touchWork.vY,};this.onDrag(g,e)}g.preventDefault()};GestureManager.prototype.touchEnd=function(a){if(this.emulateGestureEvent&&a.touches.length==1){this.gestureEnd(a)}if(this.onTouchEnd){this.onTouchEnd(a)}this.touchWork.centerX=null;this.touchWork.centerY=null};