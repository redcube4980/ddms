/*! $Id: gesture.js 173 2012-11-20 21:52:05Z tomita $ */
function GestureManager(){var a=this;this.touchWork={startX:null,startY:null,oldX:null,oldY:null,centerX:null,centerY:null,pinchDistance:null,save_time:null,oldX2:null,oldY2:null,vX:0,vY:0,pointers:{},};this.lastSingleTouch=null;document.addEventListener("MSPointerDown",function(b){a.pointerDown(b)},false);document.addEventListener("MSPointerMove",function(b){a.pointerMove(b)},false);document.addEventListener("MSPointerUp",function(b){a.pointerUp(b)},false);document.addEventListener("MSPointerCancel",function(b){a.pointerUp(b)},false);this.gestureWork={}}GestureManager.prototype.pointerCount=function(){var b=0;for(var a in this.touchWork.pointers){b++}return b};GestureManager.prototype.gestureStart=function(a){if(this.onGestureStart){this.onGestureStart(a)}};GestureManager.prototype.gestureChange=function(b){var a={centerX:this.touchWork.centerX,centerY:this.touchWork.centerY,pinchDistance:this.touchWork.pinchDistance,};if(this.touchWork.centerX!==null&&this.onGestureChange){this.onGestureChange(b,a)}b.preventDefault()};GestureManager.prototype.gestureEnd=function(a){if(this.onGestureEnd){this.onGestureEnd(a)}};GestureManager.prototype.pointerDown=function(c){c.preventDefault();var a=new Date;this.touchWork.save_time=a.getTime();this.touchWork.pointers[c.pointerId]={clientX:c.clientX,clientY:c.clientY};var d=this.pointerCount();if(d==1){this.touchWork.startX=c.clientX;this.touchWork.startY=c.clientY;this.touchWork.oldX=c.clientX;this.touchWork.oldY=c.clientY;this.touchWork.oldX2=c.clientX;this.touchWork.oldY2=c.clientY}if(d==2){this.gestureStart(c)}if(this.onTouchStart){this.onTouchStart(c)}if(d==1){var b=this.lastSingleTouch;var a=new Date;this.lastSingleTouch=a.getTime();if(b!==null){if(this.lastSingleTouch-b<500){if(this.onDoubleClick){this.onDoubleClick(c)}}}}};GestureManager.prototype.pointerMove=function(c){var a=this.touchWork.pointers[c.pointerId];if(!a){return}a.clientX=c.clientX;a.clientY=c.clientY;if(this.onTouchMove){this.onTouchMove(c)}var f=this.pointerCount();if(f>=2){var k=[];for(var h in this.touchWork.pointers){k.push(h)}k.sort();var m=this.touchWork.pointers[k[0]];var l=this.touchWork.pointers[k[1]];this.touchWork.centerX=parseInt((m.clientX+l.clientX)/2);this.touchWork.centerY=parseInt((m.clientY+l.clientY)/2);this.touchWork.pinchDistance=parseInt(Math.sqrt(Math.pow(m.clientX-l.clientX,2)+Math.pow(m.clientY-l.clientY,2)));this.gestureChange(c)}if(f!=1){return}var j=c.clientX-this.touchWork.oldX;var i=c.clientY-this.touchWork.oldY;this.touchWork.oldX=c.clientX;this.touchWork.oldY=c.clientY;var g=new Date;var e=g.getTime();if(e>this.touchWork.save_time+100){var b=(e-this.touchWork.save_time)/1000;this.touchWork.save_time=e;this.touchWork.vX=(c.clientX-this.touchWork.oldX2)/b;this.touchWork.vY=(c.clientY-this.touchWork.oldY2)/b;this.touchWork.oldX2=c.clientX;this.touchWork.oldY2=c.clientY}if(this.onDrag){var d={startX:this.touchWork.startX,startY:this.touchWork.startY,diffX:j,diffY:i,vX:this.touchWork.vX,vY:this.touchWork.vY,};this.onDrag(c,d)}c.preventDefault()};GestureManager.prototype.pointerUp=function(a){if(this.onTouchEnd){this.onTouchEnd(a)}delete this.touchWork.pointers[a.pointerId];this.touchWork.centerX=null;this.touchWork.centerY=null;var b=this.pointerCount();if(b==1){this.gestureEnd(a)}};