/*! $Id: sound.js 123 2012-02-15 06:13:16Z tomita $ */
var Sound={};(function(){var b;var m=false;var i=null;function j(n){b.open(n)}function g(){b.play()}function l(){b.pause()}function a(){b.stop()}function d(){m=true;e()}function c(){m=false;b.stop();if(i){clearTimeout(i);i=null}}function k(){i=null;if(BookContext.zoomed){return}var n=EZBook.getCurrentPage();if(n+2>lastPage){gotoPage(firstPage)}else{if(IsLeftTemplate){onRight()}else{onLeft()}}}function e(){if(!soundMode||isBGM){return}if(typeof sounds=="undefined"){return}if(!m){return}if(i){clearTimeout(i);i=null}for(var o=0;o<sounds.length;o++){var n=sounds[o].split(".");var p=n[0].split("_");if(EZBook.getCurrentPage()==p[0]){b.stop();j(soundDir+sounds[o]);if(FeaturePageSoundRelay){i=setTimeout(k,p[1]*1000)}return}}b.stop()}function h(){if(Platform.isIE()){return true}else{if(Platform.isFireFox()){return false}return Platform.supportAudioMP3()}return false}function f(){if(!soundMode){return}if(Platform.isIE()){if(Platform.supportAudio()){b=new SPAudioTag}else{try{b=new SPMediaPlayer}catch(n){alert(n);b=new SoundPlayer}}}else{if(Platform.supportAudio()){b=new SPAudioTag}else{b=new SoundPlayer}}if(isBGM){b.setAutoLoop(true);if(InitialStatePlaySound){b.setAutoStart(true)}else{b.setAutoStart(false)}j(soundDir+bgmSrc)}else{b.setAutoLoop(false);b.setAutoStart(true);if(InitialStatePlaySound){m=true}else{m=false}}}Sound.initialize=f;Sound.checkSoundCapability=h;Sound.playSound=g;Sound.pauseSound=l;Sound.stopSound=a;Sound.playPageSound=d;Sound.stopPageSound=c;Sound.loadPageSound=e})();function SoundPlayer(){this.autoStart=false;this.autoLoop=false}SoundPlayer.prototype.open=function(a){};SoundPlayer.prototype.play=function(){};SoundPlayer.prototype.pause=function(){};SoundPlayer.prototype.stop=function(){};SoundPlayer.prototype.rewind=function(){};SoundPlayer.prototype.getAutoLoop=function(){return this.autoLoop};SoundPlayer.prototype.setAutoLoop=function(a){};SoundPlayer.prototype.getAutoStart=function(){return this.autoStart};SoundPlayer.prototype.setAutoStart=function(a){};SoundPlayer.prototype.destroy=function(){};function SPMediaPlayer(){this.parent=SoundPlayer;this.parent();this.player=this._buildPlayer();if(typeof this.player.Open=="undefined"){throw Lang.CantCreateMPlayerText}this.player.AutoRewind=true;this.autoStart=false;this.autoLoop=false;this.player.AutoStart=this.autoStart;this.player.PlayCount=this.autoLoop?0:1}SPMediaPlayer.prototype=new SoundPlayer;SPMediaPlayer.prototype.open=function(a){this.player.Open(a)};SPMediaPlayer.prototype.play=function(){this.player.Play()};SPMediaPlayer.prototype.pause=function(){this.player.Pause()};SPMediaPlayer.prototype.stop=function(){this.player.Stop()};SPMediaPlayer.prototype.setAutoLoop=function(a){this.autoLoop=a?true:false;this.player.PlayCount=this.autoLoop?0:1};SPMediaPlayer.prototype.setAutoStart=function(a){this.autoStart=a?true:false;this.player.AutoStart=this.autoStart};SPMediaPlayer.prototype.destroy=function(){};SPMediaPlayer.prototype._buildPlayer=function(){var a='<OBJECT width="150" height="44" style="position:absolute;z-index:5;bottom:0px;right:0px;z-index:2000;visibility:hidden;" codeBase="http://activex.microsoft.com/activex/controls/mplayer/en/nsmp2inf.cab#Version=5,1,52,701" type="application/x-oleobject" standby="Loading Microsoft Windows Media Player components..." classid="CLSID:22D6F312-B0F6-11D0-94AB-0080C74C7E95"><PARAM NAME="AudioStream" VALUE="-1"><PARAM NAME="AutoSize" VALUE="-1"><PARAM NAME="AutoStart" VALUE="0"><PARAM NAME="AnimationAtStart" VALUE="-1"><PARAM NAME="AllowScan" VALUE="-1"><PARAM NAME="AllowChangeDisplaySize" VALUE="-1"><PARAM NAME="AutoRewind" VALUE="0"><PARAM NAME="Balance" VALUE="0"><PARAM NAME="BaseURL" VALUE=""><PARAM NAME="BufferingTime" VALUE="5"><PARAM NAME="CaptioningID" VALUE=""><PARAM NAME="ClickToPlay" VALUE="-1"><PARAM NAME="CursorType" VALUE="0"><PARAM NAME="CurrentPosition" VALUE="-1"><PARAM NAME="CurrentMarker" VALUE="0"><PARAM NAME="DefaultFrame" VALUE=""><PARAM NAME="DisplayBackColor" VALUE="0"><PARAM NAME="DisplayForeColor" VALUE="16777215"><PARAM NAME="DisplayMode" VALUE="0"><PARAM NAME="DisplaySize" VALUE="0"><PARAM NAME="Enabled" VALUE="-1"><PARAM NAME="EnableContextMenu" VALUE="0"><PARAM NAME="EnablePositionControls" VALUE="-1"><PARAM NAME="EnableFullScreenControls" VALUE="0"><PARAM NAME="EnableTracker" VALUE="-1"><PARAM NAME="Filename" VALUE=""><PARAM NAME="InvokeURLs" VALUE="-1"><PARAM NAME="Language" VALUE="-1"><PARAM NAME="Mute" VALUE="0"><PARAM NAME="PlayCount" VALUE="1"><PARAM NAME="PreviewMode" VALUE="0"><PARAM NAME="Rate" VALUE="1"><PARAM NAME="SAMILang" VALUE="kr"><PARAM NAME="SAMIStyle" VALUE=""><PARAM NAME="SAMIFileName" VALUE=""><PARAM NAME="SelectionStart" VALUE="-1"><PARAM NAME="SelectionEnd" VALUE="-1"><PARAM NAME="SendOpenStateChangeEvents" VALUE="-1"><PARAM NAME="SendWarningEvents" VALUE="-1"><PARAM NAME="SendErrorEvents" VALUE="-1"><PARAM NAME="SendKeyboardEvents" VALUE="0"><PARAM NAME="SendMouseClickEvents" VALUE="0"><PARAM NAME="SendMouseMoveEvents" VALUE="0"><PARAM NAME="SendPlayStateChangeEvents" VALUE="-1"><PARAM NAME="ShowCaptioning" VALUE="0"><PARAM NAME="ShowControls" VALUE="-1"><PARAM NAME="ShowAudioControls" VALUE="-1"><PARAM NAME="ShowDisplay" VALUE="0"><PARAM NAME="ShowGotoBar" VALUE="0"><PARAM NAME="ShowPositionControls" VALUE="0"><PARAM NAME="ShowStatusBar" VALUE="0"><PARAM NAME="ShowTracker" VALUE="-1"><PARAM NAME="TransparentAtStart" VALUE="0"><PARAM NAME="VideoBorderWidth" VALUE="0"><PARAM NAME="VideoBorderColor" VALUE="0"><PARAM NAME="VideoBorder3D" VALUE="0"><PARAM NAME="Volume" VALUE="0"><PARAM NAME="WindowlessVideo" VALUE="0"></OBJECT>';var b=document.createElement("div");b.innerHTML=a;return b.childNodes[0]};function SPAudioTag(){var a=this;this.parent=SoundPlayer;this.parent();this.player=new Audio;this.autoStart=false;this.autoLoop=false;this.needLoad=false;this.manualAutoPlay=false;this.manualAutoLoop=false;this.platform=new EBUtil.Platform;this.player.autoplay=this.autoStart;this.player.loop=this.autoLoop;if(this.player.attachEvent){this.player.attachEvent("onended",function(){a.onEnded("end")})}else{this.player.addEventListener("ended",function(){a.onEnded("end")},false)}if(this.platform.isFireFox()){this.player.autoplay=false;this.manualAutoPlay=true;this.player.loop=false;this.manualAutoLoop=true}}SPAudioTag.prototype=new SoundPlayer;SPAudioTag.prototype.open=function(a){this.player.src=a;this.needLoad=true;if(this.autoStart&&this.manualAutoPlay){this.play()}};SPAudioTag.prototype.play=function(){if(!this.player.src){return}if(this.needLoad){this.player.load();this.needLoad=false}this.player.play()};SPAudioTag.prototype.pause=function(){if(!this.player.src){return}this.player.pause()};SPAudioTag.prototype.stop=function(){if(!this.player.src){return}if(!this.player.ended){this.player.pause();this.player.currentTime=0}};SPAudioTag.prototype.setAutoLoop=function(a){this.autoLoop=a?true:false;if(!this.manualAutoLoop){this.player.loop=this.autoLoop}};SPAudioTag.prototype.setAutoStart=function(a){this.autoStart=a?true:false;if(!this.manualAutoPlay){this.player.autoplay=this.autoStart}};SPAudioTag.prototype.onEnded=function(){if(this.autoLoop&&this.manualAutoLoop){this.play()}};