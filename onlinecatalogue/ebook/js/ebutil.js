/*! $Id: ebutil.js 245 2014-01-10 04:25:54Z tomita $ */
var EBUtil={imageUrl:function(a){return"images/"+a+".jpg"},toRightStep:function(b,a){if(typeof a=="undefined"){a=2}if(b){return a}else{return -a}},toLeftStep:function(b,a){if(typeof a=="undefined"){a=2}if(b){return -a}else{return a}},isLeftPage:function(a,b){if(a){return(b&1)?true:false}else{return(b&1)?false:true}},winWidth:function(){if(typeof window.innerWidth!="undefined"){return window.innerWidth}else{if(document.compatMode=="CSS1Compat"){return document.documentElement.clientWidth}else{return document.body.clientWidth}}},winHeight:function(){if(typeof window.innerHeight!="undefined"){return window.innerHeight}else{if(document.compatMode=="CSS1Compat"){return document.documentElement.clientHeight}else{return document.body.clientHeight}}},absX:function(b){var a=0;while(b){a+=b.offsetLeft;b=b.offsetParent}return a},absY:function(a){var b=0;while(a){b+=a.offsetTop;a=a.offsetParent}return b},layerX:function(a){if(typeof a.offsetX!="undefined"){return a.offsetX}else{return a.layerX}},layerY:function(a){if(typeof a.offsetY!="undefined"){return a.offsetY}else{return a.layerY}},eventTarget:function(a){if(typeof a.srcElement!="undefined"){return a.srcElement}else{return a.target}},setOpacity:function(b,c){var a=new EBUtil.Platform;if(!a.supportOpacity()&&a.supportDXFilter()){c=parseInt(c*100);b.style.filter="alpha(opacity="+c+")"}else{b.style.opacity=c}},preventDefault:function(a){if(document.all){a.returnValue=false}else{a.preventDefault()}},iframeDoc:function(a){if(a.contentDocument){return a.contentDocument}if(a.contentWindow.document){return a.contentWindow.document}return},iframeWin:function(a){return a.contentWindow},getIFrame:function(a){return top.document.getElementById("if_screen")},getQueryParam:function(c,a){var d;if(typeof c=="string"){d=c}else{d=c.location.search}if(!d){return null}var b=new RegExp("[?&]"+a+"=([^&]*)");if(!d.match(b)){return null}return RegExp.$1},setQueryParam:function(c,b,d){var a;if(typeof c=="string"){a=c}else{a=c.location.search}var e=new RegExp("([?&]"+b+"=)([^&]*)");if(a.match(e)){new_url=a.replace(e,"$1"+d)}else{new_url=a;if(new_url.match(/[?]/)){new_url+="&"}else{new_url+="?"}new_url+=b+"="+d}return new_url},importListenerMechanism:function(a,b){a[b]={};a.addListener=function(d,c){if(!a[b][d]){return}a[b][d].addListener(c)};a.removeListener=function(d,c){if(!a[b][d]){return}a[b][d].removeListener(c)}},templateName:function(){return IsLeftTemplate?"left":"right"},setupAutoRollover:function(a,b,c){a.onmouseover=function(){a.src=c};a.onmouseout=function(){a.src=b}},_notifyImages:[null,null],_notifyImageIdx:0,notifyAction:function(e,d){if(!BookKey){return true}if(e=="l"&&!NotifyLinkClick){return true}if(document.images){var c=parseInt(Math.random()*1000000);var b=TrackURL+"?key="+BookKey+"&a="+e+"&rnd="+c;if(d){b+="&"+d}var a=new Image;a.src=b;EBUtil._notifyImages[EBUtil._notifyImageIdx++]=a;if(EBUtil._notifyImageIdx>=EBUtil._notifyImages.length){EBUtil._notifyImageIdx=0}}return true},easingLinear:function(c,a,b){return c+(a-c)*b},cookieValue:function(a){var d=new RegExp(a+"=(.*)$");var c=document.cookie.split(";");for(var b=0;b<c.length;b++){if(c[b].match(d)){return RegExp.$1}}return},_preloadRollOver:[],setupRollOver:function(e){var h=document.getElementsByTagName("img");if(!h){return}for(var c=0;c<h.length;c++){var b=h[c].className;if(!b.match(/autoRO/)){continue}var a=h[c];var f=a.src;var g=f.replace(/\.([^.]*)$/,"_ro.$1");if(f==g){continue}var d=new Image;d.src=g;EBUtil._preloadRollOver.push(d);a._aROSrc=f;a._aROSrcRO=g;a.onmouseover=function(){this.src=this._aROSrcRO};a.onmouseout=function(){this.src=this._aROSrc}}},getMousePos:function(c){var d={x:0,y:0};if(document.all){var b;var a;if(document.compatMode=="BackCompat"){b=document.body.scrollLeft;a=document.body.scrollTop}else{b=document.documentElement.scrollLeft;a=document.documentElement.scrollTop}d.x=window.event.clientX+b;d.y=window.event.clientY+a}else{d.x=c.pageX;d.y=c.pageY}return d},startMouseCapture:function(d,b){if(document.all){d="on"+d}if(document.all){document.attachEvent(d,b)}else{document.addEventListener(d,b,true)}var c=document.getElementsByTagName("iframe");for(var a=0;a<c.length;a++){if(document.all){c[a].contentWindow.document.attachEvent(d,b)}else{c[a].contentDocument.addEventListener(d,b,true)}}},stopMouseCapture:function(d,b){if(document.all){d="on"+d}if(document.all){document.detachEvent(d,b)}else{document.removeEventListener(d,b,true)}var c=document.getElementsByTagName("iframe");for(var a=0;a<c.length;a++){if(document.all){c[a].contentWindow.document.detachEvent(d,b)}else{c[a].contentDocument.removeEventListener(d,b,true)}}},openTemporaryWindow:function(b,a){var c=new EBUtil.Platform;if(c.isIPhone()){var e=c.osVersionString();if(e===null){e=0}else{e=parseFloat(e)}if(e>=6&&e<7){var d;setTimeout(function(){if(d&&!d.closed){d.close()}},1000);d=window.open(b,a)}else{window.open(b,a)}}else{if(c.isIPad()){window.open(b,a)}else{window.open(b,a)}}},closeTemporaryWindow:function(){if(!window.opener||window.opener.closed){window.close();return}var a=new EBUtil.Platform;if(a.isIPhone()){var c=a.osVersionString();if(c===null){c=0}else{c=parseFloat(c)}if(c>=6&&c<7){var b;window.opener.focus()}else{window.close()}}else{if(a.isIPad()){window.close()}else{window.close()}}},setTapAnimation:function(a){a.onclick=(function(){var d=a;var c=a.onclick;var b=a.className;return function(g){var f=this;f.className+=" tapped";setTimeout(function(){d.className=b;if(c){c(g)}},200);return true}})()},isDescendant:function(a,b){var c=b;while(c){if(c==a){return true}c=c.parentNode}return false},dummy:null};EBUtil.ListenerList=function(){this.list=[]};EBUtil.ListenerList.prototype.addListener=function(a){this.list.push(a)};EBUtil.ListenerList.prototype.removeListener=function(b){for(var a=0;a<this.list.length;a++){if(this.list[a]==b){this.list.splice(a,1);return}}};EBUtil.ListenerList.prototype.invoke=function(){for(var a=0;a<this.list.length;a++){(this.list[a]).apply(this,arguments)}};EBUtil.Platform=function(){var a=this;this._isIE=null;this._isFireFox=null;this._isChrome=null;this._isMac=null;this._isAndroid=null;this._isIPhone=null;this._isIPad=null;this._isKindle=null;this._version=null;this._osVersion=null;this._supportOpacity=null;this._supportDXFilter=null;this._supportTransform=null;this._supportCanvas=null;this._supportAudio=null;this._supportAudioMP3=null;this._supportAudioWAV=null;this._needImgOnLoadBugFix=null;EBUtil.Platform=function(){return a}};EBUtil.Platform.prototype.isIE=function(){if(this._isIE===null){var a=navigator.userAgent.toLowerCase();if(a.indexOf("msie")!=-1||a.indexOf("trident")!=-1){this._isIE=true}else{this._isIE=false}}return this._isIE};EBUtil.Platform.prototype.isFireFox=function(){if(this._isFireFox===null){var a=navigator.userAgent.toLowerCase();if(a.indexOf("firefox")!=-1){this._isFireFox=true}else{this._isFireFox=false}}return this._isFireFox};EBUtil.Platform.prototype.isChrome=function(){if(this._isChrome===null){var a=navigator.userAgent.toLowerCase();if(a.indexOf("chrome")!=-1){this._isChrome=true}else{this._isChrome=false}}return this._isChrome};EBUtil.Platform.prototype.isMac=function(){if(this._isMac===null){if(navigator.platform=="MacPPC"||navigator.platform=="MacIntel"){this._isMac=true}else{this._isMac=false}}return this._isMac};EBUtil.Platform.prototype.isAndroid=function(){if(this._isAndroid===null){var a=navigator.userAgent.toLowerCase();if(a.indexOf("android")!=-1||this.isKindle()){this._isAndroid=true}else{this._isAndroid=false}}return this._isAndroid};EBUtil.Platform.prototype.isIPhone=function(){if(this._isIPhone===null){var a=navigator.userAgent.toLowerCase();if(a.indexOf("iphone")!=-1){this._isIPhone=true}else{this._isIPhone=false}}return this._isIPhone};EBUtil.Platform.prototype.isIPad=function(){if(this._isIPad===null){var a=navigator.userAgent.toLowerCase();if(a.indexOf("ipad")!=-1){this._isIPad=true}else{this._isIPad=false}}return this._isIPad};EBUtil.Platform.prototype.isKindle=function(){if(this._isKindle===null){var a=navigator.userAgent.toLowerCase();if(a.indexOf("silk")!=-1){this._isKindle=true}else{this._isKindle=false}}return this._isKindle};EBUtil.Platform.prototype.versionString=function(){if(this._version===null){if(this.isIE()){var a=navigator.userAgent.toLowerCase();if(a.match(/(msie|rv:)\s*([0-9.]+)/)){this._version=RegExp.$2}}}return this._version};EBUtil.Platform.prototype.osVersionString=function(){if(this._osVersion===null){if(this.isAndroid()){if(this.isKindle()){this._osVersion="4.0.3"}else{var a=navigator.userAgent.toLowerCase();if(a.match(/android\s+([0-9.]+)/)){this._osVersion=RegExp.$1}}}else{if(this.isIPhone()||this.isIPad()){var a=navigator.userAgent.toLowerCase();if(a.match(/\s+os\s+([0-9_]+)\s+like/)){this._osVersion=RegExp.$1;this._osVersion=this._osVersion.replace(/_/g,".")}}}}return this._osVersion};EBUtil.Platform.prototype.supportOpacity=function(){if(this._supportOpacity===null){if(this.isIE()){if(this.versionString()<9){this._supportOpacity=false}else{this._supportOpacity=true}}else{this._supportOpacity=true}}return this._supportOpacity};EBUtil.Platform.prototype.supportDXFilter=function(){if(this._supportDXFilter===null){if(this.isIE()){if(this.versionString()<9){this._supportDXFilter=true}else{this._supportDXFilter=false}}else{this._supportDXFilter=false}}return this._supportDXFilter};EBUtil.Platform.prototype.supportTransform=function(){if(this._supportTransform===null){var a=document.createElement("div");if(typeof a.style.webkitTransform=="undefined"&&typeof a.style.MozTransform=="undefined"&&typeof a.style.msTransform=="undefined"){this._supportTransform=false}else{this._supportTransform=true}}return this._supportTransform};EBUtil.Platform.prototype.supportCanvas=function(){if(this._supportCanvas===null){if(this.isIE()){if(this.versionString()>=9){this._supportCanvas=true}else{this._supportCanvas=false}}else{this._supportCanvas=true}}return this._supportCanvas};EBUtil.Platform.prototype.supportAudio=function(){if(this._supportAudio===null){try{var a=new Audio;this._supportAudio=true}catch(b){this._supportAudio=false}}return this._supportAudio};EBUtil.Platform.prototype._checkAudioMediaSupport=function(c){if(!this.supportAudio()){return false}var b=new Audio;if(!b.canPlayType){return false}var a=b.canPlayType(c);return a?true:false};EBUtil.Platform.prototype.supportAudioMP3=function(){if(this._supportAudioMP3===null){this._supportAudioMP3=this._checkAudioMediaSupport("audio/mpeg")}return this._supportAudioMP3};EBUtil.Platform.prototype.supportAudioWAV=function(){if(this._supportAudioWAV===null){this._supportAudioWAV=this._checkAudioMediaSupport("audio/wav")}return this._supportAudioWAV};EBUtil.Platform.prototype.needImgOnLoadBugFix=function(){if(this._needImgOnLoadBugFix===null){this._needImgOnLoadBugFix=false;if(this.isIE()&&this.versionString()>=11){this._needImgOnLoadBugFix=true}}return this._needImgOnLoadBugFix};EBUtil.Sprite=function(){var a=this;this.container=document.createElement("div");this.container.style.cssText="position:absolute;left:0px;top:0px;width:10px;height:10px;overflow:hidden;";this.onCreate()};EBUtil.Sprite.prototype.getContainerNode=function(){return this.container};EBUtil.Sprite.prototype.setPos=function(a,b){this.container.style.left=parseInt(a,10)+"px";this.container.style.top=parseInt(b,10)+"px"};EBUtil.Sprite.prototype.getPosX=function(){return parseInt(this.container.style.left,10)};EBUtil.Sprite.prototype.getPosY=function(){return parseInt(this.container.style.top,10)};EBUtil.Sprite.prototype.setSize=function(a,b){this.container.style.width=a+"px";this.container.style.height=b+"px";this._update()};EBUtil.Sprite.prototype.getWidth=function(){return parseInt(this.container.style.width,10)};EBUtil.Sprite.prototype.getHeight=function(){return parseInt(this.container.style.height,10)};EBUtil.Sprite.prototype._update=function(){this.onDraw()};EBUtil.Sprite.prototype.onCreate=function(){};EBUtil.Sprite.prototype.onDraw=function(){};EBUtil.ImageLoader=function(){this.images={};this.complete=false;EBUtil.importListenerMechanism(this,"listeners");this.listeners.onload=new EBUtil.ListenerList};EBUtil.ImageLoader.prototype.addImage=function(c,b){var a=this;var d=new Image;d.onload=function(){a._onLoadCompleteImage()};this.images[b]={url:c,img:d};this.complete=false};EBUtil.ImageLoader.prototype.load=function(){for(var a in this.images){var b=this.images[a];b.img.src=b.url}};EBUtil.ImageLoader.prototype.getImage=function(a){if(this.images[a]){return this.images[a].img}return};EBUtil.ImageLoader.prototype._onLoadCompleteImage=function(){for(var a in this.images){var b=this.images[a];if(!b.img.complete){return}}if(!this.complete){this.listeners.onload.invoke();this.complete=true}};EBUtil.RectSelector=function(c,b){var a=this;this.eventLayer=c;this.markerLayer=b;this.dragContext={marker:null,startX:0,startY:0};this.cancelFlg=false;this.callMouseDown=function(d){return a._onMouseDown(d)};this.callMouseMove=function(d){return a._onMouseMove(d)};this.callMouseUp=function(d){return a._onMouseUp(d)};EBUtil.importListenerMechanism(this,"listeners");this.listeners.onselectstart=new EBUtil.ListenerList;this.listeners.onselect=new EBUtil.ListenerList};EBUtil.RectSelector.prototype.enable=function(){if(this.eventLayer.attachEvent){this.eventLayer.attachEvent("onmousedown",this.callMouseDown);this.eventLayer.attachEvent("onmousemove",this.callMouseMove);this.eventLayer.attachEvent("onmouseup",this.callMouseUp)}else{this.eventLayer.addEventListener("mousedown",this.callMouseDown,true);this.eventLayer.addEventListener("mousemove",this.callMouseMove,true);this.eventLayer.addEventListener("mouseup",this.callMouseUp,true)}};EBUtil.RectSelector.prototype.disable=function(){if(this.eventLayer.attachEvent){this.eventLayer.detachEvent("onmousedown",this.callMouseDown);this.eventLayer.detachEvent("onmousemove",this.callMouseMove);this.eventLayer.detachEvent("onmouseup",this.callMouseUp)}else{this.eventLayer.removeEventListener("mousedown",this.callMouseDown,true);this.eventLayer.removeEventListener("mousemove",this.callMouseMove,true);this.eventLayer.removeEventListener("mouseup",this.callMouseUp,true)}};EBUtil.RectSelector.prototype.cancel=function(){this.cancelFlg=true};EBUtil.RectSelector.prototype._createRectMarker=function(){var a=document.createElement("div");a.style.position="absolute";a.style.backgroundColor="#0000ff";a.style.opacity="0.5";a.style.border="1px solid black";return a};EBUtil.RectSelector.prototype._currentRect=function(b){var a={left:0,top:0,right:0,bottom:0};var c=EBUtil.getMousePos(b);if(this.dragContext.startX<c.x){a.left=this.dragContext.startX;a.right=c.x}else{a.left=c.x;a.right=this.dragContext.startX}if(this.dragContext.startY<c.y){a.top=this.dragContext.startY;a.bottom=c.y}else{a.top=c.y;a.bottom=this.dragContext.startY}return a};EBUtil.RectSelector.prototype._onMouseDown=function(b){var c=b||window.event;if(!Platform.isMac()){if(c.button==2||c.button==3){return false}}var d=c.target;if(!d&&c.srcElement){d=c.srcElement}this.cancelFlg=false;this.listeners.onselectstart.invoke({srcNode:d,x:this.dragContext.startX,y:this.dragContext.startY});if(this.cancelFlg){return false}if(this.dragContext.marker){this.dragContext.marker.parentNode.removeChild(this.dragContext.marker);this.dragContext.marker=null}var f=EBUtil.getMousePos(c);this.dragContext.startX=f.x;this.dragContext.startY=f.y;var a=this._createRectMarker();a.style.left=this.dragContext.startX+"px";a.style.top=this.dragContext.startY+"px";a.style.width="0px";a.style.height="0px";this.markerLayer.appendChild(a);this.dragContext.marker=a;return true};EBUtil.RectSelector.prototype._onMouseMove=function(c){var d=c||window.event;if(!this.dragContext.marker){return}var b=this._currentRect(d);var a=this.dragContext.marker;a.style.left=b.left+"px";a.style.top=b.top+"px";a.style.width=(b.right-b.left)+"px";a.style.height=(b.bottom-b.top)+"px";return true};EBUtil.RectSelector.prototype._onMouseUp=function(b){var c=b||window.event;if(this.dragContext.marker){this.dragContext.marker.parentNode.removeChild(this.dragContext.marker);this.dragContext.marker=null;var a=this._currentRect(c);this.listeners.onselect.invoke(a)}return true};EBUtil.PollingSystem=function(){this.tid=null;this.targets=[]};EBUtil.PollingSystem.prototype.TimerInterval=100;EBUtil.PollingSystem.prototype.PollingMax=10;EBUtil.PollingSystem.prototype.checkComplete=function(a){return true};EBUtil.PollingSystem.prototype.startPolling=function(c,a){var b={target:c,poll_cnt:0,callback:a};this.targets.push(b);if(!this.tid){this._startPollingTimer()}};EBUtil.PollingSystem.prototype.stopPolling=function(b){for(var a=0;a<this.targets.length;a++){if(this.targets[a].target===b){this.targets.splice(a,1);if(this.targets.length==0){this._stopPollingTimer()}return}}};EBUtil.PollingSystem.prototype._startPollingTimer=function(){if(this.tid!==null){return}var a=this;this.tid=setTimeout(function(){a._onPollingTimer()},this.TimerInterval)};EBUtil.PollingSystem.prototype._stopPollingTimer=function(){if(this.tid===null){return}clearTimeout(this.tid);this.tid=null};EBUtil.PollingSystem.prototype._onPollingTimer=function(){for(var a=0;a<this.targets.length;a++){this.targets[a].poll_cnt++;if(this.checkComplete(this.targets[a].target)){if(this.targets[a].callback){this.targets[a].callback(this.targets[a].target,false)}this.targets.splice(a,1);a--}else{if(this.PollingMax!=-1&&this.targets[a].poll_cnt>=this.PollingMax){if(this.targets[a].callback){this.targets[a].callback(this.targets[a].target,true)}this.targets.splice(a,1);a--}}}if(this.targets.length==0){this.tid=null;return}this.tid=null;this._startPollingTimer()};EBUtil.ImageLoadPollingSystem=new EBUtil.PollingSystem;EBUtil.ImageLoadPollingSystem.checkComplete=function(a){return a.complete};