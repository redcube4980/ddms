/*! $Id: pageprint.js 123 2012-02-15 06:13:16Z tomita $ */
var Header;var MainArea;var PageOneLayer;var PageTwoLayer;var ZoomedPage;var ZoomedLRContainer;var ZoomedPageL;var ZoomedPageR;var Preloads=[];var EnableTwoPagePrinting=false;var Platform;var ShowPageMode;function setTwoPageWidth(a){var b=parseInt(a/2);ZoomedPageL.setWidth(b);ZoomedPageR.setWidth(b);ZoomedPageL.setPos(0,0);ZoomedPageR.setPos(b,0);ZoomedLRContainer.style.width=b*2+"px";ZoomedLRContainer.style.height=ZoomedPageL.getHeight()+"px";if(Platform.supportTransform()){var c="rotate(90deg) translateX("+-ZoomedPageL.getHeight()+"px)";ZoomedLRContainer.style.webkitTransform=c;ZoomedLRContainer.style.MozTransform=c;ZoomedLRContainer.style.msTransform=c}}function layout(){var c=EBUtil.winWidth();var b=EBUtil.winHeight();MainArea.style.left="0px";MainArea.style.top=Header.offsetHeight+"px";MainArea.style.height=b+"px";switch(ShowPageMode){case 1:case 2:var d=ZoomedPage.getWidth();ZoomedPage.setPos(parseInt((c-d)/2),0);break;case 3:var e=ZoomedPageL.getHeight();var a=parseInt((c-e)/2);ZoomedLRContainer.style.left=a+"px";break}}function showPage(c){c=parseInt(c,10);ShowPageMode=c;var d=EBUtil.getQueryParam(top,"pg");if(d===null){return}d=parseInt(d,10);var a,b;if(IsLeftTemplate){a=d;b=d+1}else{a=d+1;b=d}switch(c){case 1:ZoomedPage.load(EBUtil.imageUrl(a));break;case 2:ZoomedPage.load(EBUtil.imageUrl(b));break;case 3:ZoomedPageL.load(EBUtil.imageUrl(a));ZoomedPageR.load(EBUtil.imageUrl(b));break}switch(c){case 1:case 2:PageOneLayer.style.display="block";PageTwoLayer.style.display="none";break;case 3:PageOneLayer.style.display="none";PageTwoLayer.style.display="block";break}layout()}function printPage(){Header.style.display="none";MainArea.style.backgroundColor="white";MainArea.style.top="0px";var c=EBUtil.winWidth();var b=EBUtil.winHeight();var a,f,g;switch(ShowPageMode){case 1:case 2:g=pageHeight_2Y/pageWidth_2X;a=PrintingMaxWidth;f=a*g;if(f>PrintingMaxHeight){f=PrintingMaxHeight;a=f/g}a=parseInt(a);f=parseInt(f);ZoomedPage.setWidth(a);ZoomedPage.setPos(0,0);break;case 3:g=(pageWidth_2X*2)/pageHeight_2Y;a=PrintingMaxWidth;f=a*g;if(f>PrintingMaxHeight){f=PrintingMaxHeight;a=f/g}a=parseInt(a);f=parseInt(f);if(Platform.isIE()&&Platform.supportTransform()){a=parseInt(a*1.4);f=parseInt(f*1.4)}setTwoPageWidth(f);var a=ZoomedPageL.getHeight();var f=ZoomedPageL.getWidth();ZoomedLRContainer.style.left="0px";break}var i=EBUtil.getQueryParam(top,"pg");if(i===null){return}i=parseInt(i,10);var d,e;if(IsLeftTemplate){d=i;e=i+1}else{d=i+1;e=i}switch(ShowPageMode){case 1:EBUtil.notifyAction("pr","pg="+d);break;case 2:EBUtil.notifyAction("pr","pg="+e);break;case 3:EBUtil.notifyAction("pr","pg="+d);EBUtil.notifyAction("pr","pg="+e);break}window.print();window.close()}function preloadImage(){var c=EBUtil.getQueryParam(top,"pg");if(c===null){return}c=parseInt(c,10);for(var a=0;a<2;a++){var b=new PageSliceImage(pageWidth_2X,pageHeight_2Y);b.setSliceNumber(sliceNumber);b.setWidth(PrintPreviewWidth);b.load(EBUtil.imageUrl(c+a));Preloads.push(b)}}function onResize(){layout()}function onLoad(){Header=document.getElementById("header");MainArea=document.getElementById("mainarea");PageOneLayer=document.getElementById("page_one_layer");PageTwoLayer=document.getElementById("page_two_layer");preloadImage();Platform=new EBUtil.Platform;if(Platform.isIE()||Platform.supportTransform()){EnableTwoPagePrinting=true}if(!EnableTwoPagePrinting){document.getElementById("label_page_two").style.display="none"}document.getElementById("text_left_page").innerHTML=Lang.PrintLeftPageText;document.getElementById("text_right_page").innerHTML=Lang.PrintRightPageText;var b=document.getElementById("text_page_two");if(b){b.innerHTML=Lang.PrintPageTwoText}document.forms[0].printaction.value=Lang.PrintPrintText;ZoomedLRContainer=document.createElement("div");ZoomedLRContainer.style.cssText="position:absolute;left:0px;top:0px;";var e=false;if(!Platform.isIE()){e=true}ZoomedPage=new PageSliceImage(pageWidth_2X,pageHeight_2Y);ZoomedPage.setSliceNumber(sliceNumber);ZoomedPage.setOverWrapMode(e);ZoomedPageL=new PageSliceImage(pageWidth_2X,pageHeight_2Y);ZoomedPageL.setSliceNumber(sliceNumber);ZoomedPageL.setOverWrapMode(e);ZoomedPageR=new PageSliceImage(pageWidth_2X,pageHeight_2Y);ZoomedPageR.setSliceNumber(sliceNumber);ZoomedPageR.setOverWrapMode(e);ZoomedPage.setWidth(PrintPreviewWidth);var a=parseInt(PrintPreviewWidth*pageWidth_2X/pageHeight_2Y);setTwoPageWidth(a*2);if(EnableTwoPagePrinting){if(Platform.isIE()&&!Platform.supportTransform()){var g="progid:DXImageTransform.Microsoft.BasicImage(rotation=1)";ZoomedLRContainer.style.filter=g}else{if(Platform.supportTransform()){var d="left bottom";ZoomedLRContainer.style.webkitTransformOrigin=d;ZoomedLRContainer.style.MozTransformOrigin=d;ZoomedLRContainer.style.msTransformOrigin=d}else{alert("This browser doesn't support transform property.")}}}PageOneLayer.appendChild(ZoomedPage.containerNode());PageTwoLayer.appendChild(ZoomedLRContainer);ZoomedLRContainer.appendChild(ZoomedPageL.containerNode());ZoomedLRContainer.appendChild(ZoomedPageR.containerNode());var c=IsLeftTemplate?1:2;for(var f=0;f<document.forms[0].leftpage.length;f++){if(document.forms[0].leftpage[f].value==c){document.forms[0].leftpage[f].checked=true;break}}showPage(c);document.title=Lang.WindowTitle;window.onresize=onResize;layout()};